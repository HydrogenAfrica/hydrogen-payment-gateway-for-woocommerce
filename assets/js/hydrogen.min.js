jQuery(function(e){function a(){let e=[{display_name:"Plugin",variable_name:"plugin",value:"woo-hydrogen"},];return wc_hydrogen_params.meta_order_id&&e.push({display_name:"Order ID",variable_name:"order_id",value:wc_hydrogen_params.meta_order_id}),wc_hydrogen_params.meta_name&&e.push({display_name:"Customer Name",variable_name:"customer_name",value:wc_hydrogen_params.meta_name}),wc_hydrogen_params.meta_email&&e.push({display_name:"Customer Email",variable_name:"customer_email",value:wc_hydrogen_params.meta_email}),wc_hydrogen_params.meta_phone&&e.push({display_name:"Customer Phone",variable_name:"customer_phone",value:wc_hydrogen_params.meta_phone}),wc_hydrogen_params.meta_billing_address&&e.push({display_name:"Billing Address",variable_name:"billing_address",value:wc_hydrogen_params.meta_billing_address}),wc_hydrogen_params.meta_shipping_address&&e.push({display_name:"Shipping Address",variable_name:"shipping_address",value:wc_hydrogen_params.meta_shipping_address}),wc_hydrogen_params.meta_products&&e.push({display_name:"Products",variable_name:"products",value:wc_hydrogen_params.meta_products}),e}function n(){let e={};return wc_hydrogen_params.card_channel&&(wc_hydrogen_params.banks_allowed&&(e.banks=wc_hydrogen_params.banks_allowed),wc_hydrogen_params.cards_allowed&&(e.card_brands=wc_hydrogen_params.cards_allowed)),e}function t(a,n){let t=`
            <style>
                .modal-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }

                .hydrogen-modal-container {
                    background: #fff;
                    border-radius: 20px;
                    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    max-width: 1000px !important;
                    z-index: 1001;
                }

                .modal-content {
                    padding: 20px;
                }
            </style>
            <div class="modal-overlay">
                <div class="hydrogen-modal-container">
                    <div class="modal fade" id="customModalSuccess" tabindex="-1" aria-labelledby="customModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="hydrogen-modal-body">
                                    <p>${a}</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="okButton">OK</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;e("body").append(t),e("#okButton").on("click",function(){window.location.href=n})}function r(){let e=[];return wc_hydrogen_params.bank_channel&&e.push("bank"),wc_hydrogen_params.card_channel&&e.push("card"),wc_hydrogen_params.ussd_channel&&e.push("ussd"),wc_hydrogen_params.qr_channel&&e.push("qr"),wc_hydrogen_params.bank_transfer_channel&&e.push("bank_transfer"),e}async function i(){e("#wc-hydrogen-form").hide();let a=Number(wc_hydrogen_params.amount),i=wc_hydrogen_params.meta_order_id,o=window.location.href;function s(){closeModalButton.click(),window.location.href="/cart"}window.obj={amount:a,email:wc_hydrogen_params.email,currency:wc_hydrogen_params.currency,description:"Payment for items ordered with ID "+i,customerName:wc_hydrogen_params.meta_name,meta:wc_hydrogen_params.meta_name,callback:o,isAPI:!0,returnRef:2},window.token=wc_hydrogen_params.key,Array.isArray(r())&&r().length&&(paymentData.channels=r(),e.isEmptyObject(n())||(paymentData.metadata.custom_filters=n()));let d=new URLSearchParams(window.location.search),l=d.get("TransactionRef");d.get("key");let c=window.location.href,m=c.indexOf("key=");if(-1!==m){let u=c.substring(m),p=u.indexOf("?");-1!==p&&(u=u.substring(0,p)),u.split("=")[1]}if(!l){let f=c.lastIndexOf("?");if(-1!==f){let h=c.substring(f+1).split("&");for(let y=0;y<h.length;y++){let b=h[y].split("=");if("TransactionRef"===b[0]){l=b[1];break}}}}if(l)window!==window.parent?closeModal(paymentResponseData,function e(a){window.parent.postMessage(JSON.stringify({event:"close",e:a}),"*")}):$(l);else{async function g(){try{let e=await handlePgData(window.obj,window.token);console.log("return transaction ref",e),l=e}catch(a){console.error("Error occurred:",a)}}g()}async function $(a){let n=`
                <style>
                    .spinner-overlay {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(255, 255, 255, 0.8);
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 9999;
                    }

                    .spinner {
                        border: 4px solid rgba(0, 0, 0, 0.1);
                        border-top: 4px solid #3498db;
                        border-radius: 50%;
                        width: 40px;
                        height: 40px;
                        animation: spin 1s linear infinite;
                    }

                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
                <div id="loading-spinner" class="spinner-overlay">
                    <div class="spinner"></div>
                </div>
            `;e("body").append(n),e("#wc-hydrogen-form").show();let r=wc_hydrogen_params.meta_order_id;e.ajax({url:"/wc-api/wc_gateway_hydrogen_popup",method:"POST",data:{transactionRef:JSON.stringify(a),hydrogenOderId:r},dataType:"json",beforeSend:function(){},success:function(e){let a=window.location.href.replace(/\/checkout\/order-pay\/\d+\/.*/,"");a+="/cart/","90000"===e.statusCode?t("Your payment for order #"+r+" is successful and confirmed! Check your email or account for order details.",a):t("Your payment for order #"+r+" was declined with status: Failed! Click Ok.",a)},error:function(e,a,n){console.log("Error:",a,n)},complete:function(){e("#loading-spinner").remove()}})}window.addEventListener("message",function(e){var a=JSON.parse(e.data);"close"===a.event?(console.log("Payment closed:",a.e),$(a.e)):console.log("Unknown event:",a)},!1)}e("#wc-hydrogen-form").hide(),i(),e("#hydrogen-payment-button").click(function(){i()}),e("#hydrogen_form form#order_review").submit(function(){i()})});
