jQuery(function(e){function a(){let e=[{display_name:"Plugin",variable_name:"plugin",value:"woo-hydrogen"},];return wc_hydrogen_params.meta_order_id&&e.push({display_name:"Order ID",variable_name:"order_id",value:wc_hydrogen_params.meta_order_id}),wc_hydrogen_params.meta_name&&e.push({display_name:"Customer Name",variable_name:"customer_name",value:wc_hydrogen_params.meta_name}),wc_hydrogen_params.meta_email&&e.push({display_name:"Customer Email",variable_name:"customer_email",value:wc_hydrogen_params.meta_email}),wc_hydrogen_params.meta_phone&&e.push({display_name:"Customer Phone",variable_name:"customer_phone",value:wc_hydrogen_params.meta_phone}),wc_hydrogen_params.meta_billing_address&&e.push({display_name:"Billing Address",variable_name:"billing_address",value:wc_hydrogen_params.meta_billing_address}),wc_hydrogen_params.meta_shipping_address&&e.push({display_name:"Shipping Address",variable_name:"shipping_address",value:wc_hydrogen_params.meta_shipping_address}),wc_hydrogen_params.meta_products&&e.push({display_name:"Products",variable_name:"products",value:wc_hydrogen_params.meta_products}),e}function n(){let e={};return wc_hydrogen_params.card_channel&&(wc_hydrogen_params.banks_allowed&&(e.banks=wc_hydrogen_params.banks_allowed),wc_hydrogen_params.cards_allowed&&(e.card_brands=wc_hydrogen_params.cards_allowed)),e}function t(a,n){let t=`
        <style>
          .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
          }
  
          .hydrogen-modal-container {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 1000px !important;
            z-index: 1001;
          }
  
          .modal-content {
            padding: 20px;
          }
        </style>
        <div class="modal-overlay">
          <div class="hydrogen-modal-container">
            <div class="modal fade" id="customModalSuccess" tabindex="-1" aria-labelledby="customModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="hydrogen-modal-body">
                    <p>${a}</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" id="okButton">OK</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;e("body").append(t),e("#okButton").on("click",function(){window.location.href=n})}function r(){let e=[];return wc_hydrogen_params.bank_channel&&e.push("bank"),wc_hydrogen_params.card_channel&&e.push("card"),wc_hydrogen_params.ussd_channel&&e.push("ussd"),wc_hydrogen_params.qr_channel&&e.push("qr"),wc_hydrogen_params.bank_transfer_channel&&e.push("bank_transfer"),e}async function o(){e("#wc-hydrogen-form").hide(),e("form#payment-form, form#order_review").find("input.hydrogen_txnref").val("");let a=Number(wc_hydrogen_params.amount),o=window.location.href;window.obj={amount:a,email:wc_hydrogen_params.email,currency:wc_hydrogen_params.currency,description:"Payment for items ordered with ID "+wc_hydrogen_params.meta_order_id,customerName:wc_hydrogen_params.meta_name,meta:wc_hydrogen_params.meta_name,callback:o,isAPI:!0,returnRef:2},window.token=wc_hydrogen_params.key,Array.isArray(r())&&r().length&&(paymentData.channels=r(),e.isEmptyObject(n())||(paymentData.metadata.custom_filters=n()));let i=new URLSearchParams(window.location.search),d=i.get("TransactionRef");i.get("key");let s=window.location.href,l=s.indexOf("key=");if(-1!==l){let c=s.substring(l),m=c.indexOf("?");-1!==m&&(c=c.substring(0,m)),c.split("=")[1]}if(!d){let u=window.location.href,p=u.lastIndexOf("?");if(-1!==p){let f=u.substring(p+1).split("&");for(let y=0;y<f.length;y++){let h=f[y].split("=");if("TransactionRef"===h[0]){d=h[1];break}}}}if(d){if(window!==window.parent){var g={event:"callback",transactionRef:d};window.parent.postMessage(JSON.stringify(g),"*")}else{wc_hydrogen_params.meta_order_id,wc_hydrogen_params.hydrogen_wc_redirect_url;let b=window.location.href.replace(/\/checkout\/order-pay\/\d+\/.*/,"");b+="/cart/",k(d)}}else{async function $(){try{let e=await handlePgData(window.obj,window.token,v);console.log("return transaction ref",e),d=e,window.innerWidth>768?function e(){let a=document.getElementById("hydrogenPay_modal");a&&(a.style.height="73.5%",a.style.marginTop="60px");let n=document.getElementById("hydrogenPay_myModal");n&&(n.style.zIndex="9999")}():function e(){let a=document.getElementById("hydrogenPay_modal");a&&(a.style.height="73.5%",a.style.marginTop="40px");let n=document.getElementById("hydrogenPay_myModal");n&&(n.style.zIndex="9999")}()}catch(a){console.error("Error occurred:",a)}}$()}function v(e){window.parent.postMessage(JSON.stringify({event:"close",transactionRef:e}),"*")}function k(a){let n=`
          <style>
            .spinner-overlay {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(255, 255, 255, 0.8);
              display: flex;
              justify-content: center;
              align-items: center;
              z-index: 9999;
            }
  
            .spinner {
              border: 4px solid rgba(0, 0, 0, 0.1);
              border-top: 4px solid #3498db;
              border-radius: 50%;
              width: 40px;
              height: 40px;
              animation: spin 1s linear infinite;
            }
  
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
          </style>
          <div id="loading-spinner" class="spinner-overlay">
            <div class="spinner"></div>
          </div>
        `;e("body").append(n),e("#wc-hydrogen-form").show();let r=wc_hydrogen_params.meta_order_id;e.ajax({url:"/wc-api/wc_gateway_hydrogen_popup",method:"POST",data:{transactionRef:JSON.stringify(a),hydrogenOderId:r},dataType:"json",beforeSend:function(){},success:function(e){let a=window.location.href.replace(/\/checkout\/order-pay\/\d+\/.*/,"");(a+="/cart/","90000"===e.statusCode)?t(`Your payment for order #${r} is successful and confirmed! Check your email or account for order details.`,a):t(`Your payment for order #${r} was declined with status: Failed! Click Ok.`,a)},error:function(e,a,n){console.log("Error:",a,n)},complete:function(){e("#loading-spinner").remove()}})}window.addEventListener("message",function(e){var a=JSON.parse(e.data);switch(a.event){case"callback":console.log("Callback successful:",a.transactionRef),function e(a){let n=document.getElementById("hydrogenPay_myModal");n&&(n.remove(),k(a))}(a.transactionRef);break;case"close":console.log("Payment Modal closed and execute payment confirmation:",a.transactionRef),k(a.transactionRef);break;default:console.log("Unknown event:",a)}},!1)}e("#wc-hydrogen-form").hide(),o(),e("#hydrogen-payment-button").click(function(){o()}),e("#hydrogen_form form#order_review").submit(function(){o()})});
